(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{136:function(e,t,a){e.exports=a(148)},141:function(e,t,a){},143:function(e,t,a){},148:function(e,t,a){"use strict";a.r(t);var r=a(15),n=a.n(r),o=a(130),c=a.n(o),i=(a(141),a(142),a(143),a(116)),s=a(78),l=a(71),m=a(117),u=a(118),h=a(122),d=a(119),p=a(123),f=a(89),v=a(61),y=a(135),g=a(66),C="http://13.48.69.71:8081";function b(e){if(!e.ok)throw console.error(e.statusText),new Error(e.statusText);return e}var E=function(e){var t=e.dateFrom,a=e.dateTo,r=e.timeFrom,n=e.timeTo;return"00:00"===r&&(r="00:00:00"),"00:00"===n&&(n="00:00:00"),"startDateTime=".concat(t,"T").concat(r,".000&endDateTime=").concat(a,"T").concat(n,".000")},x=function(){return n.a.createElement("h3",{className:"text-center mt-5 mb-5 text-secondary"},"No Data")},D={chartId:"js-chart-xy",chartPieId:"js-chart-pie",openedColor:"blue",closedColor:"red"},k=function(e){function t(e){var a;Object(m.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e))).xyChart=void 0,a.pieChart=void 0,a.dateAxis=void 0,a.rangesColors={PRESENT:Object(v.a)(D.closedColor),NOT_PRESENT:Object(v.a)(D.openedColor)},a.create=function(){Promise.all([a.fetchXyChartData(),a.fetchPieChartData(),a.fetchDoorStateChartData()]).then(function(e){var t=Object(l.a)(e,3),r=t[0],n=t[1],o=t[2];a.createXyChart(r),a.createPieChart(n),a.renderRanges(o)}).catch(console.error).finally(function(){return a.setState({isLoading:!1})})},a.update=function(){Promise.all([a.fetchXyChartData(),a.fetchPieChartData(),a.fetchDoorStateChartData()]).then(function(e){var t=Object(l.a)(e,3),r=t[0],n=t[1],o=t[2];a.setXyChartData(r),a.setPieChartData(a.preparePieChartData(n)),a.renderRanges(o)}).catch(console.error)},a.datepickerChanged=function(e,t){a.setState({datepicker:Object(s.a)({},a.state.datepicker,Object(i.a)({},e,t))})},Object(v.c)(y.a);var r=new Date;return a.state={isLoading:!0,location:e.match.params.id,datepicker:{dateFrom:a.formatDate(new Date(r.setDate(r.getDate()-1))),timeFrom:(new Date).toLocaleTimeString(),dateTo:a.formatDate(new Date),timeTo:(new Date).toLocaleTimeString()},charts:{pie:[],xy:[]}},a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.create()}},{key:"componentWillUnmount",value:function(){this.xyChart&&this.xyChart.dispose(),this.pieChart&&this.pieChart.dispose()}},{key:"renderRanges",value:function(e){var t=this,a=e.data,r=this.dateAxis;r&&(r.axisRanges.clear(),a.forEach(function(e){t.createRange(r,new Date(e.startDateTime),new Date(e.endDateTime),t.rangesColors[e.state])}))}},{key:"setXyChartData",value:function(e){this.setState({charts:Object(s.a)({},this.state.charts,{xy:e})}),this.xyChart&&(this.xyChart.data=e)}},{key:"setPieChartData",value:function(e){this.setState({charts:Object(s.a)({},this.state.charts,{pie:e})}),this.pieChart&&(this.pieChart.data=e)}},{key:"preparePieChartData",value:function(e){var t=e.openTime,a=e.closedTime,r=this.splitTime(t),n=Object(l.a)(r,2),o=n[0],c=n[1],i=this.splitTime(a),s=Object(l.a)(i,2),m=s[0],u=s[1];return 0===parseInt(t)&&0===parseInt(a)?[]:[{state:"Opened",amount:this.calcAmount(o,c),color:Object(v.a)(D.openedColor).lighten(.65)},{state:"Closed",amount:this.calcAmount(m,u),color:Object(v.a)(D.closedColor).lighten(.65)}]}},{key:"splitTime",value:function(e){var t=e.split(":"),a=Object(l.a)(t,2);return[a[0],a[1]]}},{key:"calcAmount",value:function(e,t){return 60*parseInt(e)+parseInt(t)}},{key:"fetchXyChartData",value:function(){return function(e){var t="".concat(C,"/rooms/").concat(e.id,"/temperatureData?").concat(E(e));return fetch(t).then(b).then(function(e){return e.json()})}(Object(s.a)({id:this.state.location},this.state.datepicker)).then(function(e){var t=e.data;return(void 0===t?[]:t).map(function(e){return{temperature:e.temperature,timestamp:new Date(e.timestamp)}})})}},{key:"fetchPieChartData",value:function(){return function(e){var t="".concat(C,"/rooms/").concat(e.id,"/doorStateStatistic?").concat(E(e));return fetch(t).then(b).then(function(e){return e.json()})}(Object(s.a)({id:this.state.location},this.state.datepicker))}},{key:"fetchDoorStateChartData",value:function(){return function(e){var t="".concat(C,"/rooms/").concat(e.id,"/doorStateData?").concat(E(e));return fetch(t).then(b).then(function(e){return e.json()})}(Object(s.a)({id:this.state.location},this.state.datepicker))}},{key:"createRange",value:function(e,t,a,r){var n=e.axisRanges.create();n.value=t,n.endValue=a,n.axisFill.fill=r,n.axisFill.fillOpacity=.3}},{key:"createXyChart",value:function(e){this.xyChart=Object(v.b)(D.chartId,g.f),this.xyChart.cursor=new g.h,this.setXyChartData(e),this.dateAxis=this.xyChart.xAxes.push(new g.a),this.dateAxis.title.text="\ud83d\udd51 Time",this.dateAxis.tooltipDateFormat="dd.MM",this.dateAxis.dateFormats.setKey("hour","MMMM dt"),this.dateAxis.periodChangeDateFormats.setKey("hour","MMMM dt"),this.dateAxis.startLocation=1,this.dateAxis.endLocation=0,this.xyChart.yAxes.push(new g.e).title.text="\ud83c\udf21 (\xb0C)";var t=this.xyChart.series.push(new g.b);t.dataFields.valueY="temperature",t.dataFields.dateX="timestamp",t.name="Temperature",t.stroke=Object(v.a)("yellow").lighten(.1),t.fill=Object(v.a)("#efefef"),t.strokeWidth=1,t.tooltipText="At {dateX.formatDate('HH:mm')} the temperature was {valueY}\xb0";var a=new g.g;a.series.push(t),this.xyChart.scrollbarX=a}},{key:"createPieChart",value:function(e){var t=e.openTime,a=e.closedTime;this.pieChart=Object(v.b)(D.chartPieId,g.c);var r=this.pieChart.series.push(new g.d);r.slices.template.propertyFields.fill="color",r.slices.template.propertyFields.stroke="color",r.dataFields.value="amount",r.dataFields.category="state",r.slices.template.tooltipText="{category}: {value.value} minutes",this.setPieChartData(this.preparePieChartData({openTime:t,closedTime:a}))}},{key:"formatDate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.toISOString().split("T")[t]}},{key:"render",value:function(){var e=this,t=this.state,a=t.location,r=t.isLoading,o=t.datepicker,c=t.charts;return n.a.createElement("div",{className:"container"},n.a.createElement("div",{className:"row mb-5"},n.a.createElement("div",{className:"col-12"},n.a.createElement("div",{className:"row mb-3 mt-3"},n.a.createElement("div",{className:"col-3"},n.a.createElement(f.b,{to:"/",className:"text-decoration-none"},n.a.createElement("button",{type:"button",className:"btn btn-light alert btn-block"},n.a.createElement("span",{role:"img","aria-label":"go back"},"\u2190")," select room"))),n.a.createElement("div",{className:"col-9"},n.a.createElement("div",{className:"alert alert-success text-center"},a))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col"},n.a.createElement("div",{className:"form-group"},n.a.createElement("label",null,"Date From"),n.a.createElement("input",{type:"date",className:"form-control",onChange:function(t){var a=t.target.value;return e.datepickerChanged("dateFrom",a)},value:o.dateFrom}))),n.a.createElement("div",{className:"col"},n.a.createElement("div",{className:"form-group"},n.a.createElement("label",null,"Time From"),n.a.createElement("input",{type:"time",className:"form-control",onChange:function(t){var a=t.target.value;return e.datepickerChanged("timeFrom",a)},value:o.timeFrom}))),n.a.createElement("div",{className:"col"},n.a.createElement("div",{className:"form-group"},n.a.createElement("label",null,"Date To"),n.a.createElement("input",{type:"date",className:"form-control",onChange:function(t){var a=t.target.value;return e.datepickerChanged("dateTo",a)},value:o.dateTo}))),n.a.createElement("div",{className:"col"},n.a.createElement("div",{className:"form-group"},n.a.createElement("label",null,"Time To"),n.a.createElement("input",{type:"time",className:"form-control",onChange:function(t){var a=t.target.value;return e.datepickerChanged("timeTo",a)},value:o.timeTo}))),n.a.createElement("div",{className:"col"},n.a.createElement("label",null,"\xa0"),n.a.createElement("button",{onClick:this.update,type:"button",className:"form-control btn btn-outline-primary"},n.a.createElement("span",{role:"img","aria-label":"go back"},"\ud83d\udd04")))),n.a.createElement("div",{className:"alert alert-warning d-flex justify-content-around align-items-center"},n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("div",{className:"rounded-circle mr-2",style:{width:"1rem",height:"1rem",backgroundColor:D.openedColor}}),n.a.createElement("div",null,"Door Opened")),n.a.createElement("div",null,"Temperature"),n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("div",{className:"rounded-circle mr-2",style:{width:"1rem",height:"1rem",backgroundColor:D.closedColor}}),n.a.createElement("div",null,"Door Closed"))),n.a.createElement("div",{id:D.chartId,style:{width:"100%",height:"25rem",display:0===c.xy.length?"none":"block"}}),0===c.xy.length&&!r&&n.a.createElement(x,null),n.a.createElement("div",{className:"alert alert-secondary text-center"},"Proximity"),n.a.createElement("div",{id:D.chartPieId,className:"mt-5",style:{width:"100%",height:"10rem",display:0===c.pie.length?"none":"block"}}),0===c.pie.length&&!r&&n.a.createElement(x,null))))}}]),t}(n.a.Component),N=a(134),O=function(e){var t=e.onChange,a=Object(r.useState)(""),o=Object(l.a)(a,2),c=o[0],i=o[1],s=function(e){i(e),t(e)};return n.a.createElement("div",{className:"form-group"},n.a.createElement("input",{type:"text",className:"form-control",value:c,placeholder:"Search for a room..",onChange:function(e){var t=e.target.value;return s(t)}}))},j=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e))).filterRooms=function(e){var t=a.state.initialRooms,r=e.toLowerCase(),n=e?t.filter(function(e){return e.toLowerCase().indexOf(r)>-1}):t;a.setState({rooms:n})},a.state={initialRooms:[],rooms:[]},a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this,t=sessionStorage.getItem("rooms");t?this.setRooms(JSON.parse(t)):fetch("".concat(C,"/rooms")).then(b).then(function(e){return e.json()}).then(function(t){e.setRooms(t),e.cacheRooms(t)})}},{key:"setRooms",value:function(e){this.setState({initialRooms:e,rooms:Object(N.a)(e)})}},{key:"cacheRooms",value:function(e){sessionStorage.setItem("rooms",JSON.stringify(e))}},{key:"render",value:function(){return r.createElement("div",{className:"container mt-4"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-6 offset-3"},r.createElement(O,{onChange:this.filterRooms}))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-6 offset-3"},r.createElement("div",{className:"list-group mb-5"},this.state.rooms.map(function(e){return r.createElement(f.b,{to:"/room/".concat(e),key:e,className:"list-group-item list-group-item-action"},e)})))))}}]),t}(r.Component),T=a(70);var w=function(){return n.a.createElement(f.a,null,n.a.createElement(T.a,{exact:!0,path:"/",component:j}),n.a.createElement(T.a,{path:"/room/:id",component:k}))};c.a.render(n.a.createElement(w,null),document.getElementById("root"))}},[[136,1,3]]]);
//# sourceMappingURL=main.2c4ea30c.chunk.js.map